{"version":3,"sources":["scraper.es6.js"],"names":[],"mappings":"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","file":"scraper.js","sourcesContent":["/**\n * Script to scrape and parse lord of the rings script hosted\n * at http://www.ageofthering.com/atthemovies/scripts/\n *\n * NOTE scraper.js is probably not needed as nodejs supports a lot of the es6 features\n */\n\nvar cheerio = require('cheerio'),\n    request = require('request'),\n    pmongo = require('promised-mongo'),\n    $;\nrequire('prototypes');\n\nvar dbUrl = 'mongodb://localhost/lordOfTheRingsScript';\n\nvar db = pmongo(dbUrl);\nvar fellowshipCollection = db.collection('fellowship');\n\nvar scriptURL = \"http://www.ageofthering.com/atthemovies/scripts/fellowshipofthering1to4.php\";\n\nfunction generateScriptUrl(maxScene){\n    var items = Math.floor(maxScene/4);\n    var urlArr = [];\n    for(var i = 1; i< items + 1; i++){\n        urlArr.push(\"http://www.ageofthering.com/atthemovies/scripts/fellowshipofthering\"\n            + (i * 4 - 3) + \"to\" + i*4 + \".php\")\n    }\n\n    return urlArr\n}\n\nfunction parseScript(err, resp, html){\n    if(err){\n        console.log(error);\n        return\n    }\n    if (resp.statusCode == 200) {\n        $ = cheerio.load(html);\n        var tempArr = $('td').filter(function (i, el) {\n            return $(el).attr(\"valign\") == \"top\";\n        });\n        var textArr = [];\n        tempArr.each(function (i, el) {\n            textArr.push($(el).text());\n        });\n        var sceneIndices = [];\n        textArr.forEach((el, i) => {\n            if(el.startsWith(\" \\r\\nScene\") == true){\n                sceneIndices.push({index:i, id: el.split(\" \")[2]})\n            }\n        });\n        var parsed = splitScenes(textArr, sceneIndices);\n        console.log(parsed)\n        saveToDB(fellowshipCollection, parsed);\n    }\n\n}\n\nfunction saveToDB(collection, parsedScriptObj){\n    for(var item in parsedScriptObj){\n        if(parsedScriptObj.hasOwnProperty(item)){\n            var doc = {\n                sceneNumber: item,\n                characters: parsedScriptObj[item]\n            }\n\n        }\n    }\n    return collection.insert(doc).then(() => {console.log(\"inserted\")});\n}\n/**\n * basically this splits the characters from 1 page of html into the scenes\n * (the pages where the script is hosted is in sets of 4 scenes each)\n * @param textArr\n * @param sceneIndexArr\n * @returns {{}}\n */\nfunction splitScenes(textArr, sceneIndexArr){\n    var out = {};\n    var numberOfScenes = sceneIndexArr.length;\n    for(var i = 0; i< numberOfScenes; i++) {\n        var temp;\n        if(i < numberOfScenes -1){\n            temp = textArr.slice((sceneIndexArr[i].index + 1), sceneIndexArr[i+1].index);\n        }else {\n            temp = textArr.slice(sceneIndexArr[numberOfScenes -1])\n        }\n        //var temp = textArr.slice((sceneIndexArr[i].index + 1), sceneIndexArr[i+1].index);\n        var characterArr = temp.filter(d => d.endsWith(\":\"))\n        out[sceneIndexArr[i].id] = characterArr.map(d => d.split(\":\")[0].toLowerCase())\n\n    }\n    //out[sceneIndexArr[numberOfScenes-1].id] = textArr.slice(sceneIndexArr[numberOfScenes -1]).filter(d => d.endsWith(\":\"))\n    return out;\n}\n\nrequest(scriptURL, parseScript);\n//console.log(generateScriptUrl(40))\n"]}